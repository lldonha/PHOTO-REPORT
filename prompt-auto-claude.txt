# PHOTO-REPORT: Sistema Completo de Relat√≥rios Fotogr√°ficos de Obra

## CONTEXTO

Criar sistema inspirado no SoloCator para engenheiros tirarem fotos de obra com overlay autom√°tico de GPS/b√∫ssola/data, sincroniza√ß√£o com Google Drive, e gera√ß√£o de relat√≥rios PDF profissionais.

**Refer√™ncias visuais:** Veja fotos de exemplo em `referencias/` e documenta√ß√£o em `Context/referencias-solocator.md`

## STACK T√âCNICO

### Backend (J√Å EXISTE - REUTILIZAR)
- FastAPI Python (porta 8002)
- Endpoints prontos: /processar-foto, /aplicar-mascara, /gerar-pdf, /health
- Pillow para overlay
- py-staticmaps para mini-mapas
- WeasyPrint para PDF
- Localiza√ß√£o: E:\Projetos\PHOTO-REPORT\backend\src\python\

### Mobile (CRIAR - Spec 001)
- **Expo (React Native)** - Framework principal
- expo-camera - Captura de fotos
- expo-location - GPS e b√∫ssola
- expo-file-system - Armazenamento local
- AsyncStorage - Offline-first database
- react-native-google-drive-api-wrapper - Sync

### Web Interface (CRIAR - Spec 002)
- **React + Vite** - Framework
- **dnd-kit** - Drag-and-drop para reordenar fotos
- **A2UI-inspired components** - UI moderna e interativa
- Integra√ß√£o com backend FastAPI existente

### Sync (CRIAR - Spec 003)
- Google Drive API
- OAuth 2.0 authentication
- Sync bidirecional (mobile ‚Üî drive ‚Üî web)

## FUNCIONALIDADES PRINCIPAIS

### 1. App Mobile (Expo) - SPEC 001

**Captura de Fotos:**
- C√¢mera integrada com expo-camera
- GPS autom√°tico via expo-location
- B√∫ssola/orienta√ß√£o autom√°tica
- SEMPRE salvar 2 vers√µes:
  - `originais/foto-{timestamp}.jpg` - Sem modifica√ß√£o
  - `com_mascara/foto-{timestamp}.jpg` - Com overlay

**Overlay Autom√°tico:**
- Barra inferior preta semi-transparente
- Campos exibidos:
  ```
  üìÖ Data/Hora: 31/12/2025 14:30
  üìç GPS: -15.789123, -47.890456
  üß≠ Dire√ß√£o: NE (45¬∞)
  üìù Project: [Nome do Projeto]
  üìù Description: [Descri√ß√£o da foto]
  üìù Notes: [Observa√ß√µes adicionais]
  ```

**Campos Edit√°veis:**
- Project Name (texto curto)
- Photo Description (texto m√©dio)
- Notes (texto longo, opcional)
- Edi√ß√£o inline ANTES de aplicar m√°scara

**Offline-First:**
- AsyncStorage para metadados
- Filesystem local para fotos
- Queue de sync quando online
- Indicador visual de "pendente sync"

**Google Drive Sync:**
- Autentica√ß√£o OAuth Google
- Estrutura de pastas autom√°tica:
  ```
  DiarioObra/
  ‚îî‚îÄ‚îÄ Projetos/
      ‚îî‚îÄ‚îÄ [Nome do Projeto]/
          ‚îú‚îÄ‚îÄ originais/
          ‚îú‚îÄ‚îÄ com_mascara/
          ‚îú‚îÄ‚îÄ validadas/
          ‚îî‚îÄ‚îÄ metadados.json
  ```
- Sync incremental (apenas novas/modificadas)
- Conflict resolution (√∫ltimo timestamp vence)

**Backend Integration:**
- Chamar FastAPI /processar-foto para extrair EXIF
- Chamar /aplicar-mascara para gerar vers√£o com overlay
- Usar py-staticmaps para mini-mapa (opcional no mobile)

### 2. Web Interface (React) - SPEC 002

**Layout Inspirado A2UI:**
- Grid responsivo de fotos
- Cards com:
  - Thumbnail da foto
  - Mini-mapa (se GPS dispon√≠vel)
  - Metadados (data, GPS, b√∫ssola)
  - Campos edit√°veis inline
  - Checkbox "Incluir no PDF"
  - √çcone de status (original/com m√°scara/validada)

**Componentes Din√¢micos:**
- Photo Grid (drag-and-drop com dnd-kit)
- Inline Text Editor (legendas)
- Map Viewer (mini-mapa expand√≠vel)
- Timeline Viewer (fotos ordenadas cronologicamente)
- Filtros (projeto, data, status)
- Preview de PDF antes de gerar

**Modo "Big Picture":**
- Visualiza√ß√£o compacta de TODAS as fotos
- Edi√ß√£o contextual (v√™ outras fotos enquanto edita)
- Reordena√ß√£o visual (arrastar e soltar)
- Marca√ß√£o bulk (incluir/excluir m√∫ltiplas fotos)

**Integra√ß√£o com Backend:**
- Ler fotos do Google Drive
- Editar legendas e salvar metadados.json
- Adicionar mini-mapas sob demanda (bot√£o "Adicionar Mapa")
- Gerar PDF final via /gerar-pdf

**Gera√ß√£o de PDF:**
- Template customiz√°vel
- 6 fotos por p√°gina (grid 2x3)
- Cabe√ßalho: T√≠tulo, Obra, Respons√°vel, Data
- Fotos com overlay + mini-mapa (se selecionado)
- Rodap√© com pagina√ß√£o
- Export em alta qualidade (90% JPEG)

### 3. Google Drive Sync - SPEC 003

**Autentica√ß√£o:**
- OAuth 2.0 flow
- Refresh token persistence
- Multi-device support

**Estrutura de Pastas:**
- Criar automaticamente se n√£o existir
- Permiss√µes: owner (usu√°rio autenticado)
- Metadados em JSON:
  ```json
  {
    "version": "1.0",
    "projeto": "Nome do Projeto",
    "fotos": [
      {
        "id": "uuid",
        "filename": "foto-123.jpg",
        "timestamp": "2025-12-31T14:30:00Z",
        "gps": {"lat": -15.789, "lon": -47.890},
        "direction": 45,
        "fields": {
          "project": "Obra XPTO",
          "description": "Fachada frontal",
          "notes": "Revisar acabamento"
        },
        "status": "com_mascara",
        "incluirPDF": true
      }
    ]
  }
  ```

**Sync Bidirecional:**
- Mobile ‚Üí Drive: Upload novas fotos + metadados
- Drive ‚Üí Web: Download e exibi√ß√£o
- Web ‚Üí Drive: Salvar edi√ß√µes em metadados.json
- Conflict resolution: timestamp mais recente vence

**Otimiza√ß√µes:**
- Resumable uploads (fotos grandes)
- Thumbnail generation local
- Delta sync (apenas mudan√ßas)
- Cache local de metadados

## PADR√ïES E REFER√äNCIAS

### Design System
- **Mobile:** Material Design 3 (React Native Paper)
- **Web:** Modern minimal (inspirado A2UI Composer)
- **Cores:** Neutras com acentos azul (#007bff)
- **Tipografia:** Inter/Roboto

### Backend API (EXISTENTE)
- Base URL: `http://localhost:8002`
- CORS habilitado
- Documenta√ß√£o: `http://localhost:8002/docs` (Swagger)

### Overlay Pattern (do backend existente)
```python
# J√° implementado em overlay_generator.py
- Altura barra: 100px
- Fundo: (0, 0, 0, 200) # Preto semi-transparente
- √çcones: Emojis nativos (üìÖüìçüß≠üìù)
- Fontes: DejaVuSans.ttf ou Arial
- Legenda: Cor amarela para destaque
```

## CRIT√âRIOS DE SUCESSO

### Spec 001 - Mobile App
- [ ] Captura foto e extrai GPS/b√∫ssola
- [ ] Salva 2 vers√µes (original + m√°scara)
- [ ] Campos edit√°veis antes de aplicar overlay
- [ ] Funciona 100% offline
- [ ] Sync com Google Drive quando online
- [ ] Indicador visual de status de sync

### Spec 002 - Web Interface
- [ ] Exibe grid de fotos do Google Drive
- [ ] Edi√ß√£o inline de legendas
- [ ] Drag-and-drop para reordenar
- [ ] Adiciona mini-mapas sob demanda
- [ ] Preview de PDF antes de gerar
- [ ] Gera PDF com fotos selecionadas

### Spec 003 - Google Drive Sync
- [ ] OAuth funcional
- [ ] Estrutura de pastas autom√°tica
- [ ] Sync incremental (n√£o re-upload tudo)
- [ ] Conflict resolution funciona
- [ ] metadados.json sempre atualizado

## REFER√äNCIAS T√âCNICAS

### SoloCator (inspira√ß√£o)
- 2 vers√µes de foto (original + overlay)
- Campos: Project, Description, Notes
- GPS + b√∫ssola + data/hora
- Export KML/KMZ (futuro)

### CAAL (arquitetura)
- Local-first com sync cloud
- Tools via webhooks
- Auto-discovery de funcionalidades

### A2UI (UI/UX)
- Componentes din√¢micos
- Agent-driven interface
- Cross-platform (web/mobile)
- JSON declarativo para widgets

### Backend Existente
- C√≥digo em: `E:\Projetos\PHOTO-REPORT\backend\src\python\`
- Arquivos principais:
  - `processor.py` - API FastAPI
  - `exif_extractor.py` - Extra√ß√£o GPS/data
  - `overlay_generator.py` - Aplica√ß√£o de m√°scara
  - `map_generator.py` - Mini-mapas
  - `pdf_generator.py` - Gera√ß√£o de PDF

## IMPORTANTE

1. **N√ÉO recriar backend** - Reutilizar Python existente
2. **Stack mobile:** Expo (React Native), N√ÉO Flutter
3. **Stack web:** React + Vite, N√ÉO Next.js
4. **2 vers√µes SEMPRE:** original intoc√°vel + com overlay
5. **Offline-first:** App funciona sem internet
6. **Google Drive:** Estrutura de pastas padronizada
7. **A2UI style:** Componentes modernos e interativos

## ORDEM DE IMPLEMENTA√á√ÉO

1. **Spec 001:** Mobile App (Expo) - Captura + Sync
2. **Spec 002:** Web Interface (React) - Visualiza√ß√£o + PDF
3. **Spec 003:** Google Drive Sync - Bidirecional robusto

## NOTAS ADICIONAIS

- Budget: FREE stack (sem servi√ßos pagos al√©m de Claude MAX)
- Usu√°rios: Solo dev + beta testers
- Deploy: Docker local + Cloudflare Tunnel
- Git: Usar worktrees do Auto-Claude
- QA: Valida√ß√£o autom√°tica antes de merge
